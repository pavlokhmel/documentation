<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimizing storage performance &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nris.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/nris.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
        <script src="../_static/design-tabs.js?v=36754332"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="File transfer" href="file_transfer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/user_communities.html">User communities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/project_leader_support.html">Project leader support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/opslog.html">Using the status system (opslog)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/remote-desktop.html">Remote Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nird_archive/user-guide.html">Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jobs/overview.html">Running jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/tuning-applications.html">Tuning applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_development/overview.html">Code development and tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/licenses.html">Licence and access policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimizing storage performance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-to-avoid">What to avoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lustre-file-system-betzy-and-fram">Lustre file system (Betzy and Fram)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-find-out-the-current-striping">How to find out the current striping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rules-of-thumb-to-set-stripe-counts">Rules of thumb to set stripe counts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#large-files">Large files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#small-files">Small files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beegfs-filesystem-saga">BeeGFS filesystem (Saga)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimizing storage performance</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/UNINETTSigma2/documentation/blob/main/files_storage/performance.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimizing-storage-performance">
<span id="storage-performance"></span><h1>Optimizing storage performance<a class="headerlink" href="#optimizing-storage-performance" title="Link to this heading"></a></h1>
<section id="what-to-avoid">
<h2>What to avoid<a class="headerlink" href="#what-to-avoid" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Avoid having a <strong>large number of files in a single directory</strong> and
rather split files in multiple sub-directories.</p></li>
<li><p><strong>Avoid repetitive <code class="docutils literal notranslate"><span class="pre">stat</span></code></strong> operations because it can create a significant
load on the file system.</p></li>
<li><p><strong>Do not use <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code></strong> on large directories, because it can be slow.  Rather
use <code class="docutils literal notranslate"><span class="pre">ls</span></code> and run <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code> only for the specific files you need
extended information about.</p></li>
</ul>
</section>
<section id="lustre-file-system-betzy-and-fram">
<span id="lustre-filesystem"></span><h2>Lustre file system (Betzy and Fram)<a class="headerlink" href="#lustre-file-system-betzy-and-fram" title="Link to this heading"></a></h2>
<p>To get best throughput on the scratch file system (<code class="docutils literal notranslate"><span class="pre">/cluster/work</span></code>), you may
need to change the data striping. Striping shall be adjusted based on the
client access pattern to optimally load the object storage targets (OSTs).
On Lustre, the OSTs are referring to disks or storage volumes constructing the
whole file system.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">stripe_count</span></code> indicates how many OSTs to use.
The <code class="docutils literal notranslate"><span class="pre">stripe_size</span></code> indicates how much data to write to one OST before moving to
the next OST.</p>
<ul class="simple">
<li><p>Striping will only take affect <em>only</em> on new files, created or copied
into the specified directory or file name.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">stripe_count</span></code> on <code class="docutils literal notranslate"><span class="pre">/cluster</span></code> file system on Fram is 1.</p></li>
<li><p>Betzy is implementing Progressive File Layouts to dynamically set file stripe
size based on file size growth.</p></li>
</ul>
<p>For more detailed information on striping, please consult the
<a class="reference external" href="https://www.lustre.org/">Lustre</a> documentation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Betzy: Progressive File Layouts</strong></p>
<p>PFL removes the need to explicitly specify striping for each file,
assigning different Lustre striping characteristics to contiguous
segments of a ﬁle as it grows.
Dynamic striping allows lower overhead for small files and assures
increased bandwidth for larger files.
However, note that for workloads with signiﬁcant random read phases it is
best to manually assign stripe size and count.</p>
<p><strong>Betzy: Data on Metadata</strong></p>
<p>Lustre file system performance is optimized for large files. To balance
that, data on metadata (DoM) is enabled on Betzy to ensure higher
performance in case of frequently accessed small files.
Files accessed with a size of 2KB or smaller will be stored on a very
fast NVMe JBOD directly connected to the metadata servers.</p>
</div>
<section id="how-to-find-out-the-current-striping">
<h3>How to find out the current striping<a class="headerlink" href="#how-to-find-out-the-current-striping" title="Link to this heading"></a></h3>
<p>To see the current stripe size (in bytes), use <code class="docutils literal notranslate"><span class="pre">lfs</span> <span class="pre">getsripe</span> <span class="pre">[file_system,</span> <span class="pre">dir,</span> <span class="pre">file]</span></code>
command. e.g.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lfs<span class="w"> </span>getstripe<span class="w"> </span>example.txt

<span class="go">example.txt</span>
<span class="go">lmm_stripe_count:  1</span>
<span class="go">lmm_stripe_size:   1048576</span>
<span class="go">lmm_pattern:       raid0</span>
<span class="go">lmm_layout_gen:    0</span>
<span class="go">lmm_stripe_offset: 75</span>
<span class="go">	obdidx		 objid		 objid		 group</span>
<span class="go">	    75	      54697336	    0x3429d78	             0</span>
</pre></div>
</div>
</section>
<section id="rules-of-thumb-to-set-stripe-counts">
<h3>Rules of thumb to set stripe counts<a class="headerlink" href="#rules-of-thumb-to-set-stripe-counts" title="Link to this heading"></a></h3>
<p>For best performance we urge you to always profile the I/O characteristics of
your HPC application and tune the I/O behavior.</p>
<p>Here is a list of rules you may apply to set stripe count for
your files:</p>
<ul class="simple">
<li><p>files smaller than 1 GB: default striping</p></li>
<li><p>files size between 1 GB - 10 GB: stripe count 2</p></li>
<li><p>files size between 10 GB - 1 TB: stripe count 4</p></li>
<li><p>files bigger than 1 TB: stripe count 8</p></li>
</ul>
</section>
<section id="large-files">
<h3>Large files<a class="headerlink" href="#large-files" title="Link to this heading"></a></h3>
<p>For large files it is advisable to increase stripe count and perhaps chunk size,
too. e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># stripe huge file across 8 OSTs</span>
$<span class="w"> </span>lfs<span class="w"> </span>setstripe<span class="w"> </span>--stripe-count<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="s2">&quot;my_file&quot;</span>

<span class="c1"># stripe across 4 OSTs using 8 MB chunks.</span>
$<span class="w"> </span>lfs<span class="w"> </span>setstripe<span class="w"> </span>--stripe-size<span class="w"> </span>8M<span class="w"> </span>--stripe-count<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="s2">&quot;my_dir&quot;</span>
</pre></div>
</div>
<p>It is advisable to use higher stripe count for applications that
write to a single file from hundreds of nodes, or a binary executable that
is loaded by many nodes when an application starts.</p>
<p>Choose a stripe size between 1 MB and 4 MB for sequential I/O. Larger than 4 MB
stripe size may result in performance loss in case of shared files.</p>
<p>Set the stripe size a multiple of the write() size, if your application is
writing in a consistent and aligned way.</p>
</section>
<section id="small-files">
<h3>Small files<a class="headerlink" href="#small-files" title="Link to this heading"></a></h3>
<p>For many small files and one client accessing each file, change stripe count to 1.
Avoid having small files with large stripe counts. This negatively impacts the
performance due to the unnecessary communication to multiple OSTs.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lfs<span class="w"> </span>setstripe<span class="w"> </span>--stripe-count<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;my_dir&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="beegfs-filesystem-saga">
<span id="saga-filesystem"></span><h2>BeeGFS filesystem (Saga)<a class="headerlink" href="#beegfs-filesystem-saga" title="Link to this heading"></a></h2>
<p>Striping in BeeGFS (<code class="docutils literal notranslate"><span class="pre">/cluster</span></code>) cannot be re-configured on Saga by users, it can currently
only be modified by system administrators.</p>
<p>But one thing you can do is to check the current stripe size (here for an example file):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>beegfs-ctl<span class="w"> </span>--getentryinfo<span class="w"> </span>example.txt

<span class="go">Entry type: file</span>
<span class="go">EntryID: 55-628B3E1D-144</span>
<span class="go">Metadata node: mds3-p2-m4 [ID: 324]</span>
<span class="go">Stripe pattern details:</span>
<span class="go">+ Type: RAID0</span>
<span class="go">+ Chunksize: 512K</span>
<span class="go">+ Number of storage targets: desired: 4; actual: 4</span>
<span class="go">+ Storage targets:</span>
<span class="go">  + 1203 @ oss-4-1-stor2 [ID: 12]</span>
<span class="go">  + 2101 @ oss-4-2-stor1 [ID: 21]</span>
<span class="go">  + 2102 @ oss-4-2-stor1 [ID: 21]</span>
<span class="go">  + 2103 @ oss-4-2-stor1 [ID: 21]</span>
</pre></div>
</div>
<p>This shows that this particular file is striped over 4 object storage targets.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="file_transfer.html" class="btn btn-neutral float-left" title="File transfer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Integrate opslog banner -->
<span class="sp-status"></span>
<script>
  window.statuspalWidget = {
    subdomain: 'sigma2-nris',
    host: 'https://statuspal.eu',
    badge: {
      enabled: false,
      selector: '.sp-status', 
    },
    banner: {
      enabled: true,
      position: 'top-right',
    }
  }
</script>
<script src="https://statuspal.io/js/widget.js"></script>


</body>
</html>