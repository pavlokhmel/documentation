<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gaussian NRIS machines Job Examples &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nris.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/nris.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
        <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../../../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/user_communities.html">User communities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/project_leader_support.html">Project leader support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/opslog.html">Using the status system (opslog)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/remote-desktop.html">Remote Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_archive/user-guide.html">Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jobs/overview.html">Running jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/tuning-applications.html">Tuning applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/overview.html">Code development and tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licenses.html">Licence and access policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Gaussian NRIS machines Job Examples</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/UNINETTSigma2/documentation/blob/main/software/application_guides/gaussian/gaussian_job_example.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gaussian-nris-machines-job-examples">
<span id="gaussian-job-examples"></span><h1>Gaussian NRIS machines Job Examples<a class="headerlink" href="#gaussian-nris-machines-job-examples" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we present tested examples for various job types on the different NRIS machines.
This will be under more or less continoues development, and if you find things missing
and/or not working as expected, do not hesitate to <a class="reference internal" href="../../../getting_help/support_line.html#support-line"><span class="std std-ref">contact us</span></a>.</p>
</div>
<section id="expected-knowledge-base">
<h2>Expected knowledge base<a class="headerlink" href="#expected-knowledge-base" title="Link to this heading"></a></h2>
<p>Before you run any Gaussian calculations, or any other calculations on NRIS machines for that matter, you are expected to update yourself on NRIS machinery specifics. A decent minimal curriculum is as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../hpc_machines/hardware_overview.html#hardware-overview"><span class="std std-ref">Overview over our machines</span></a></p></li>
<li><p><a class="reference internal" href="../../../getting_started/getting_started.html#getting-started"><span class="std std-ref">Getting started</span></a></p></li>
<li><p><a class="reference internal" href="../../../getting_started/getting_started.html#getting-started"><span class="std std-ref">Getting started</span></a></p></li>
<li><p><a class="reference internal" href="../../../jobs/overview.html#running-jobs"><span class="std std-ref">Running jobs</span></a></p></li>
<li><p><a class="reference internal" href="../../../jobs/job_scripts.html#job-scripts"><span class="std std-ref">Job Scripts</span></a></p></li>
</ul>
<section id="finding-available-gaussian-versions-and-submitting-a-standard-gaussian-job">
<h3>Finding available Gaussian versions and submitting a standard Gaussian job<a class="headerlink" href="#finding-available-gaussian-versions-and-submitting-a-standard-gaussian-job" title="Link to this heading"></a></h3>
<p>To see which versions of Gaussian software which are available on a given machine; type the following command after logged into the machine in question:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>module avail Gaussian
</pre></div>
</div>
<p>To use Gaussian, type</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>module load Gaussian/&lt;version&gt;
</pre></div>
</div>
<p>specifying one of the available versions.</p>
<p><strong>Please inspect the job script examples before submitting jobs!</strong></p>
<p>To run an example - create a directory, step into it, create an input file (for example for water - see below), download a job script (for example the fram cpu job script as shown below) and submit the script with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sbatch fram_g16.sh
</pre></div>
</div>
</section>
</section>
<section id="gaussian-input-file-examples">
<h2>Gaussian input file examples<a class="headerlink" href="#gaussian-input-file-examples" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Water input example (note the blank line at the end; <code class="docutils literal notranslate"><span class="pre">water.com</span></code>):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chk</span><span class="o">=</span><span class="n">water</span>
<span class="o">%</span><span class="n">mem</span><span class="o">=</span><span class="mi">500</span><span class="n">MB</span>
<span class="c1">#p b3lyp/cc-pVDZ opt</span>

<span class="n">structure</span> <span class="n">optimization</span> <span class="n">of</span> <span class="n">water</span>

<span class="mi">0</span> <span class="mi">1</span>
<span class="n">O</span>
<span class="n">H</span> <span class="mi">1</span> <span class="mf">0.96</span>
<span class="n">H</span> <span class="mi">1</span> <span class="mf">0.96</span> <span class="mi">2</span> <span class="mf">109.471221</span>

</pre></div>
</div>
<ul class="simple">
<li><p>Caffeine input example (note the blank line at the end; <code class="docutils literal notranslate"><span class="pre">caffeine.com</span></code>):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">chk</span><span class="o">=</span><span class="n">caffeine</span>
<span class="o">%</span><span class="n">mem</span><span class="o">=</span><span class="mi">5</span><span class="n">GB</span>
<span class="c1">#p b3lyp/cc-pVQZ</span>

<span class="n">caffeine</span> <span class="n">molecule</span> <span class="n">example</span>

<span class="mi">0</span> <span class="mi">1</span>
<span class="n">C</span>     <span class="mf">1.179579</span>     <span class="mf">0.000000</span>    <span class="o">-</span><span class="mf">0.825950</span>
<span class="n">C</span>     <span class="mf">2.359623</span>     <span class="mf">0.000000</span>     <span class="mf">0.016662</span>
<span class="n">C</span>     <span class="mf">2.346242</span>     <span class="mf">0.000000</span>     <span class="mf">1.466600</span>
<span class="n">C</span>     <span class="mf">0.000000</span>     <span class="mf">0.000000</span>     <span class="mf">1.440000</span>
<span class="n">C</span>     <span class="mf">4.217536</span>     <span class="mf">0.000000</span>     <span class="mf">1.154419</span>
<span class="n">C</span>     <span class="mf">4.765176</span>    <span class="o">-</span><span class="mf">0.384157</span>    <span class="o">-</span><span class="mf">0.964164</span>
<span class="n">C</span>     <span class="mf">1.058378</span>    <span class="o">-</span><span class="mf">0.322767</span>     <span class="mf">3.578004</span>
<span class="n">C</span>    <span class="o">-</span><span class="mf">1.260613</span>    <span class="o">-</span><span class="mf">0.337780</span>    <span class="o">-</span><span class="mf">0.608570</span>
<span class="n">N</span>     <span class="mf">1.092573</span>     <span class="mf">0.000000</span>     <span class="mf">2.175061</span>
<span class="n">N</span>     <span class="mf">0.000000</span>     <span class="mf">0.000000</span>     <span class="mf">0.000000</span>
<span class="n">N</span>     <span class="mf">3.391185</span>     <span class="mf">0.000000</span>     <span class="mf">1.965657</span>
<span class="n">N</span>     <span class="mf">3.831536</span>     <span class="mf">0.000000</span>     <span class="mf">0.062646</span>
<span class="n">O</span>    <span class="o">-</span><span class="mf">1.345306</span>     <span class="mf">0.000000</span>     <span class="mf">1.827493</span>
<span class="n">O</span>     <span class="mf">1.192499</span>     <span class="mf">0.000000</span>    <span class="o">-</span><span class="mf">2.225890</span>
<span class="n">H</span>    <span class="o">-</span><span class="mf">1.997518</span>    <span class="o">-</span><span class="mf">0.535233</span>     <span class="mf">0.168543</span>
<span class="n">H</span>    <span class="o">-</span><span class="mf">1.598963</span>     <span class="mf">0.492090</span>    <span class="o">-</span><span class="mf">1.227242</span>
<span class="n">H</span>    <span class="o">-</span><span class="mf">1.138698</span>    <span class="o">-</span><span class="mf">1.225644</span>    <span class="o">-</span><span class="mf">1.227242</span>
<span class="n">H</span>     <span class="mf">0.031688</span>    <span class="o">-</span><span class="mf">0.271264</span>     <span class="mf">3.937417</span>
<span class="n">H</span>     <span class="mf">1.445570</span>    <span class="o">-</span><span class="mf">1.329432</span>     <span class="mf">3.728432</span>
<span class="n">H</span>     <span class="mf">1.672014</span>     <span class="mf">0.388303</span>     <span class="mf">4.129141</span>
<span class="n">H</span>     <span class="mf">4.218933</span>    <span class="o">-</span><span class="mf">0.700744</span>    <span class="o">-</span><span class="mf">1.851470</span>
<span class="n">H</span>     <span class="mf">5.400826</span>     <span class="mf">0.464419</span>    <span class="o">-</span><span class="mf">1.212737</span>
<span class="n">H</span>     <span class="mf">5.381834</span>    <span class="o">-</span><span class="mf">1.206664</span>    <span class="o">-</span><span class="mf">0.604809</span>
<span class="n">H</span>     <span class="mf">5.288201</span>     <span class="mf">0.000000</span>     <span class="mf">1.353412</span>

</pre></div>
</div>
</section>
<section id="running-gaussian-on-fram">
<h2>Running Gaussian on Fram<a class="headerlink" href="#running-gaussian-on-fram" title="Link to this heading"></a></h2>
<p>On Fram, you currently run exclusively on nodes by default. Note that means that you are using the nodes exclusively - thus if you ask for less than a full node, you might experience that more than one job is stacked on one node. This is something that you should keep in mind when submitting jobs.</p>
<ul class="simple">
<li><p>Job script example (<code class="docutils literal notranslate"><span class="pre">fram_g16.sh</span></code>):</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH --account=nnXXXXk</span>
<span class="c1">#SBATCH --job-name=example</span>
<span class="c1">#SBATCH --time=0-00:05:00</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=32</span>
<span class="c1">#SBATCH --output=slurm.%j.log</span>

<span class="c1"># make the program and environment visible to this script</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>Gaussian/g16_C.01

<span class="c1"># name of input file without extension</span>
<span class="nv">input</span><span class="o">=</span>water

<span class="c1"># set the heap-size for the job to 20GB</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GAUSS_LFLAGS2</span><span class="o">=</span><span class="s2">&quot;--LindaOptions -s 20000000&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGI_FASTMATH_CPU</span><span class="o">=</span>avx2


<span class="c1"># create the temporary folder</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GAUSS_SCRDIR</span><span class="o">=</span>/cluster/work/users/<span class="nv">$USER</span>/<span class="nv">$SLURM_JOB_ID</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># split large temporary files into smaller parts</span>
lfs<span class="w"> </span>setstripe<span class="w"> </span>--stripe-count<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># copy input file to temporary folder</span>
cp<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>/<span class="nv">$input</span>.com<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># run the program</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>
<span class="nb">time</span><span class="w"> </span>g16.ib<span class="w"> </span><span class="nv">$input</span>.com<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$input</span>.out

<span class="c1"># copy result files back to submit directory</span>
cp<span class="w"> </span><span class="nv">$input</span>.out<span class="w"> </span><span class="nv">$input</span>.chk<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>

<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="running-gaussian-on-saga">
<h2>Running Gaussian on Saga<a class="headerlink" href="#running-gaussian-on-saga" title="Link to this heading"></a></h2>
<p>On Saga there are more restrictions and tricky situations to consider than on Fram. First and foremost, there is a heterogenous setup with some nodes having 52 cores and most nodes having 40 cores. Secondly, on Saga there is a 256 core limit, efficiently limiting the useful maximum amount of nodes for a Gaussian job on Saga to 6. And third, since you do share the nodes by default - you need to find a way to set resource allocations in a sharing environment not necessarily heterogenous across your given nodes.</p>
<p>Currently, we are working to find a solution to all these challenges and as of now our advices are:
Up to and including 2 nodes should can be done with standard advices for running jobs on Saga.
For 3 nodes and above you either need to run with full nodes or using the slurm exclusive flag:  <code class="docutils literal notranslate"><span class="pre">#SBATCH--exclusive</span></code>. We prefer the latter due to robustness.</p>
<p>To facilitate this, the g16 wrapper has been edited to both be backwards compatible and adjust for the more recent insight on our side. If you are not using this wrapper, please look into the wrapper to find syntax for using in your job script. Wrapper(s) are all available in Gaussian Software folder. Current name is g16.ib.</p>
<ul class="simple">
<li><p>Job script example (<code class="docutils literal notranslate"><span class="pre">saga_g16.sh</span></code>):</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH --account=nnXXXXk</span>
<span class="c1">#SBATCH --job-name=example</span>
<span class="c1">#SBATCH --time=0-00:05:00</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=40</span>
<span class="c1">#SBATCH --mem=32G</span>
<span class="c1">#SBATCH --output=slurm.%j.log</span>

<span class="c1"># make the program and environment visible to this script</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>Gaussian/g16_C.01

<span class="nb">export</span><span class="w"> </span><span class="nv">GAUSS_LFLAGS2</span><span class="o">=</span><span class="s2">&quot;--LindaOptions -s 20000000&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGI_FASTMATH_CPU</span><span class="o">=</span>avx2

<span class="c1"># name of input file without extension</span>
<span class="nv">input</span><span class="o">=</span>water

<span class="c1"># create the temporary folder</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GAUSS_SCRDIR</span><span class="o">=</span>/cluster/work/users/<span class="nv">$USER</span>/<span class="nv">$SLURM_JOB_ID</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># copy input file to temporary folder</span>
cp<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>/<span class="nv">$input</span>.com<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># run the program</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>
<span class="nb">time</span><span class="w"> </span>g16.ib<span class="w"> </span><span class="nv">$input</span>.com<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$input</span>.out

<span class="c1"># copy result files back to submit directory</span>
cp<span class="w"> </span><span class="nv">$input</span>.out<span class="w"> </span><span class="nv">$input</span>.chk<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>

<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="running-gaussian-on-gpus-on-saga">
<h2>Running Gaussian on GPUs on Saga<a class="headerlink" href="#running-gaussian-on-gpus-on-saga" title="Link to this heading"></a></h2>
<p>Both of the current <code class="docutils literal notranslate"><span class="pre">g16</span></code> versions on Saga supports GPU offloading, and we have provided
an alternative wrapper script for launching the GPU version. The only things that
need to change in the run script are the resource allocation, by adding <code class="docutils literal notranslate"><span class="pre">--gpus=N</span></code>
and <code class="docutils literal notranslate"><span class="pre">--partition=accel</span></code>, and to use the <code class="docutils literal notranslate"><span class="pre">g16.gpu</span></code> wrapper script instead of <code class="docutils literal notranslate"><span class="pre">g16.ib</span></code>.
The <code class="docutils literal notranslate"><span class="pre">g16.gpu</span></code> script is available through the standard Gaussian modules, <code class="docutils literal notranslate"><span class="pre">Gaussian/g16_B.01</span></code>
and <code class="docutils literal notranslate"><span class="pre">Gaussian/g16_C.01</span></code> (the latter will likely have better GPU performance since it is
the more recent version).</p>
<p>There are some important limitations for the current GPU version:</p>
<ul class="simple">
<li><p>It can only be run as single-node (up to 24 CPU cores + 4 GPU), so please specify <code class="docutils literal notranslate"><span class="pre">--nodes=1</span></code></p></li>
<li><p>The number of GPUs must be specified with the <code class="docutils literal notranslate"><span class="pre">--gpus=N</span></code> flag (not <code class="docutils literal notranslate"><span class="pre">--gpus-per-task</span></code>)</p></li>
<li><p>The billing ratio between GPUs and CPUs is 6:1 on Saga, so the natural way to increment
resources is to add 6 CPUs per GPU</p></li>
<li><p>Not all parts of Gaussian is able to utilize GPU resources. From the official <a class="reference external" href="https://gaussian.com/gpu/">docs</a>:</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GPUs are effective for larger molecules when doing DFT energies, gradients and frequencies
(for both ground and excited states), but they are not effective for small jobs. They are
also not used effectively by post-SCF calculations such as MP2 or CCSD.
</pre></div>
</div>
<ul class="simple">
<li><p>Run script example (<code class="docutils literal notranslate"><span class="pre">gpu_g16.sh</span></code>)</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH --account=nnXXXXk</span>
<span class="c1">#SBATCH --job-name=example</span>
<span class="c1">#SBATCH --time=0-01:00:00</span>
<span class="hll"><span class="c1">#SBATCH --nodes=1</span>
</span><span class="hll"><span class="c1">#SBATCH --ntasks=6</span>
</span><span class="hll"><span class="c1">#SBATCH --gpus=1</span>
</span><span class="hll"><span class="c1">#SBATCH --partition=accel</span>
</span><span class="c1">#SBATCH --mem=96G</span>
<span class="c1">#SBATCH --output=slurm.%j.log</span>

<span class="c1"># make the program and environment visible to this script</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>Gaussian/g16_C.01

<span class="nb">export</span><span class="w"> </span><span class="nv">PGI_FASTMATH_CPU</span><span class="o">=</span>skylake

<span class="c1"># name of input file without extension</span>
<span class="nv">input</span><span class="o">=</span>caffeine

<span class="c1"># create the temporary folder</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GAUSS_SCRDIR</span><span class="o">=</span>/cluster/work/users/<span class="nv">$USER</span>/<span class="nv">$SLURM_JOB_ID</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># copy input file to temporary folder</span>
cp<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>/<span class="nv">$input</span>.com<span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>

<span class="c1"># run the program</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$GAUSS_SCRDIR</span>
<span class="hll"><span class="nb">time</span><span class="w"> </span>g16.gpu<span class="w"> </span><span class="nv">$input</span>.com<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$input</span>.out
</span>
<span class="c1"># copy result files back to submit directory</span>
cp<span class="w"> </span><span class="nv">$input</span>.out<span class="w"> </span><span class="nv">$input</span>.chk<span class="w"> </span><span class="nv">$SLURM_SUBMIT_DIR</span>

<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>Some timing examples are listed below for a single-point energy calculation on the
Caffeine molecule using a large quadruple zeta basis set. The requested resources are
chosen based on billing units, see <a class="reference internal" href="../../../jobs/projects_accounting.html#projects-accounting"><span class="std std-ref">Projects and accounting</span></a>, where one GPU is the
equvalent of six CPU cores. Then the memory is chosen such that it will <em>not</em> be the
determining factor for the overall billing.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Configuration</p></th>
<th class="head text-center"><p>CPUs</p></th>
<th class="head text-center"><p>GPUs</p></th>
<th class="head text-center"><p>MEM</p></th>
<th class="head text-center"><p>Run time</p></th>
<th class="head text-center"><p>Speedup</p></th>
<th class="head text-center"><p>Billing</p></th>
<th class="head text-center"><p>CPU-hrs</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>Reference</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>4G</p></td>
<td class="text-center"><p>6h51m26s</p></td>
<td class="text-center"><p>1.0</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>6.9</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>1 GPU equivalent</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>20G</p></td>
<td class="text-center"><p>1h00m45s</p></td>
<td class="text-center"><p>6.8</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>6.1</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>2 GPU equivalents</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>40G</p></td>
<td class="text-center"><p>36m08s</p></td>
<td class="text-center"><p>11.4</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>7.2</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>3 GPU equivalents</p></td>
<td class="text-center"><p>18</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>60G</p></td>
<td class="text-center"><p>30m14s</p></td>
<td class="text-center"><p>13.6</p></td>
<td class="text-center"><p>18</p></td>
<td class="text-center"><p>9.1</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>4 GPU equivalents</p></td>
<td class="text-center"><p>24</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>80G</p></td>
<td class="text-center"><p>19m52s</p></td>
<td class="text-center"><p>20.7</p></td>
<td class="text-center"><p>24</p></td>
<td class="text-center"><p>7.9</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>Full normal node</p></td>
<td class="text-center"><p>40</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>140G</p></td>
<td class="text-center"><p>13m05s</p></td>
<td class="text-center"><p>31.4</p></td>
<td class="text-center"><p>40</p></td>
<td class="text-center"><p>8.7</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>1/4 GPU node</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>80G</p></td>
<td class="text-center"><p>22m41s</p></td>
<td class="text-center"><p>18.1</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>2.3</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>1/2 GPU node</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>160G</p></td>
<td class="text-center"><p>15m44s</p></td>
<td class="text-center"><p>26.2</p></td>
<td class="text-center"><p>12</p></td>
<td class="text-center"><p>3.1</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>3/4 GPU node</p></td>
<td class="text-center"><p>18</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>240G</p></td>
<td class="text-center"><p>12m03s</p></td>
<td class="text-center"><p>34.1</p></td>
<td class="text-center"><p>18</p></td>
<td class="text-center"><p>3.6</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>Full GPU node</p></td>
<td class="text-center"><p>24</p></td>
<td class="text-center"><p>4</p></td>
<td class="text-center"><p>320G</p></td>
<td class="text-center"><p>10m12s</p></td>
<td class="text-center"><p>40.3</p></td>
<td class="text-center"><p>24</p></td>
<td class="text-center"><p>4.1</p></td>
</tr>
</tbody>
</table>
<p>The general impression from these numbers is that Gaussian scales quite well for this
particular calculation, and we see from the last column that the GPU version is
consistently about a factor two more efficient than the CPU version, when comparing
the actual consumed CPU-hours. This will of course depend on the conversion factor from
CPU to GPU billing, which will depend on the system configuration, but at least with
the current ratio of 6:1 on Saga it seems to pay off to use the GPU over the CPU
version (queuing time not taken into account).</p>
<p>If you find any issues with the GPU version of Gaussian, please contact us at <a class="reference internal" href="../../../getting_help/support_line.html#support-line"><span class="std std-ref">our support line</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The timings in the table above represent a single use case, and the behavior might be
very different in other situations. Please perform simple benchmarks to check that
the program runs efficiently with your particular computational setup. Also do not
hesitate to contact us if you need guidance on GPU efficiency, see our extended
<a class="reference internal" href="../../../getting_help/extended_support/gpu.html#extended-support-gpu"><span class="std std-ref">GPU Support</span></a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Integrate opslog banner -->
<span class="sp-status"></span>
<script>
  window.statuspalWidget = {
    subdomain: 'sigma2-nris',
    host: 'https://statuspal.eu',
    badge: {
      enabled: false,
      selector: '.sp-status', 
    },
    banner: {
      enabled: true,
      position: 'top-right',
    }
  }
</script>
<script src="https://statuspal.io/js/widget.js"></script>


</body>
</html>