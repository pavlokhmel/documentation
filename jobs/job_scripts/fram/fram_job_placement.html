<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Placement on Fram &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nris.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/nris.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
        <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../../../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/user_communities.html">User communities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/project_leader_support.html">Project leader support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/opslog.html">Using the status system (opslog)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/remote-desktop.html">Remote Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_archive/user-guide.html">Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Running jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/tuning-applications.html">Tuning applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/overview.html">Code development and tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/licenses.html">Licence and access policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Job Placement on Fram</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/UNINETTSigma2/documentation/blob/main/jobs/job_scripts/fram/fram_job_placement.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="job-placement-on-fram">
<span id="job-placement-fram"></span><h1>Job Placement on Fram<a class="headerlink" href="#job-placement-on-fram" title="Link to this heading"></a></h1>
<p>The compute nodes on Fram are divided into four groups, called
<em>islands</em>.  Each island has about the same number of nodes.  The
Infiniband network throughput (“speed”) within an island is higher than
the throughput between islands.  Some jobs need high network throughput
between its nodes, and will usually run faster if they run within a
single island.</p>
<section id="default-setup">
<h2>Default Setup<a class="headerlink" href="#default-setup" title="Link to this heading"></a></h2>
<p>Therefore, the queue system is configured to run each job within one
island, if that does not delay the job too much.  It works like this:
When a job is submitted, the queue system lets the job wait until there
are enough free resources so that it can run within one island.  If this
has not happened when the job has waited 7 days<a class="footnote-reference brackets" href="#id5" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, the job will be
started on more than one island.</p>
</section>
<section id="overriding-the-setup">
<h2>Overriding the Setup<a class="headerlink" href="#overriding-the-setup" title="Link to this heading"></a></h2>
<p>The downside of requiring that all nodes belonging to a job should be in the
same island, is that the job might have to wait longer in the queue,
especially if the job needs many nodes.  Some jobs do not need high network
throughput between its nodes.  For such jobs, you can override the setup,
either for individual jobs or for all your jobs.</p>
<section id="individual-jobs">
<h3>Individual Jobs<a class="headerlink" href="#individual-jobs" title="Link to this heading"></a></h3>
<p>For individual jobs, you can use the switch <code class="docutils literal notranslate"><span class="pre">--switches=N[&#64;time]</span></code> <em>on the
command line</em> when submitting the job, where <em>N</em> is the maximal number of
islands to use (1, 2, 3 or 4), and <em>time</em> (optional) is the maximum time to
wait.  See <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">sbatch</span></code> for details.  Two examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--switches=2          # Allow two islands
--switches=1@4-0:0:0  # Change max wait time to 4 days
</pre></div>
</div>
<p>The maximal possible wait time to specify is 28 days<a class="footnote-reference brackets" href="#id5" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.  <em>A longer time
will silently be truncated to 28 days!</em></p>
<p>Note that putting this option in an <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> line in the job script will
<strong>not</strong> work (it will silently be overridden by the environment variables we
set to get the default behaviour)!</p>
<p>On the other hand, you might want to guarantee that your job never,
ever, starts on more than one island.  The easiest way to do that is to
specify <code class="docutils literal notranslate"><span class="pre">--constraint=[island1|island2|island3|island4]</span></code> instead (this option
can be used either on the command line or in the job script).</p>
</section>
<section id="changing-the-defaults">
<h3>Changing the Defaults<a class="headerlink" href="#changing-the-defaults" title="Link to this heading"></a></h3>
<p>For changing the default for your jobs, you can change the
followin environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SBATCH_REQ_SWITCH</span></code>: Max number of islands for <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SALLOC_REQ_SWITCH</span></code>: Max number of islands for <code class="docutils literal notranslate"><span class="pre">salloc</span></code> jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SRUN_REQ_SWITCH</span></code>: Max number of islands for <code class="docutils literal notranslate"><span class="pre">srun</span></code> jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SBATCH_WAIT4SWITCH</span></code>: Max wait time for <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SALLOC_WAIT4SWITCH</span></code>: Max wait time for <code class="docutils literal notranslate"><span class="pre">salloc</span></code> jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SRUN_WAIT4SWITCH</span></code>: Max wait time for <code class="docutils literal notranslate"><span class="pre">srun</span></code> jobs.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">salloc</span></code> and <code class="docutils literal notranslate"><span class="pre">srun</span></code> jobs are interactive jobs; see <a class="reference internal" href="../../interactive_jobs.html#interactive-jobs"><span class="std std-ref">Interactive jobs</span></a>.
As above, the maximal possible wait
time to specify is 28 days<a class="footnote-reference brackets" href="#id5" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, and any time longer than that will <em>silently be
truncated</em>.  The change takes effect for jobs submitted after you change the
variables.  For instance, to change the default to allow two islands, and wait
up to two weeks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SBATCH_REQ_SWITCH</span><span class="o">=</span><span class="m">2</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SALLOC_REQ_SWITCH</span><span class="o">=</span><span class="m">2</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SRUN_REQ_SWITCH</span><span class="o">=</span><span class="m">2</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SBATCH_WAIT4SWITCH</span><span class="o">=</span><span class="m">14</span>-00:00:00
<span class="nb">export</span><span class="w"> </span><span class="nv">SALLOC_WAIT4SWITCH</span><span class="o">=</span><span class="m">14</span>-00:00:00
<span class="nb">export</span><span class="w"> </span><span class="nv">SRUN_WAIT4SWITCH</span><span class="o">=</span><span class="m">14</span>-00:00:00
</pre></div>
</div>
<p>Note that we do <em>not</em> recommend that you unset these variables.  If you want
your jobs to start on any nodes, whichever island they are on, simply set
<code class="docutils literal notranslate"><span class="pre">*_REQ_SWITCH</span></code> variables to 4.  Specifically, if you unset the
<code class="docutils literal notranslate"><span class="pre">*_WAIT4SWITCH</span></code> variables, they will default to 28 days<a class="footnote-reference brackets" href="#id5" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.  Also, in the
future we might change the underlying mechanism, in which case unsetting these
variables will have no effect (but setting them will).</p>
<p><strong>Footnotes</strong></p>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>,<a role="doc-backlink" href="#id3">3</a>,<a role="doc-backlink" href="#id4">4</a>)</span>
<p>The limits might change in the future.</p>
</aside>
</aside>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Integrate opslog banner -->
<span class="sp-status"></span>
<script>
  window.statuspalWidget = {
    subdomain: 'sigma2-nris',
    host: 'https://statuspal.eu',
    badge: {
      enabled: false,
      selector: '.sp-status', 
    },
    banner: {
      enabled: true,
      position: 'top-right',
    }
  }
</script>
<script src="https://statuspal.io/js/widget.js"></script>


</body>
</html>