<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Questions and answers from Best Practices on NRIS Clusters May 2022, Day 1 (May 23) &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/nris.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/nris.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
        <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../../../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/user_communities.html">User communities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/project_leader_support.html">Project leader support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/opslog.html">Using the status system (opslog)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/remote-desktop.html">Remote Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_archive/user-guide.html">Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jobs/overview.html">Running jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../computing/tuning-applications.html">Tuning applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_development/overview.html">Code development and tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/licenses.html">Licence and access policies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Questions and answers from Best Practices on NRIS Clusters May 2022, Day 1 (May 23)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/UNINETTSigma2/documentation/blob/main/training/material/2022-spring-best-practices/q_and_a-day1.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="questions-and-answers-from-best-practices-on-nris-clusters-may-2022-day-1-may-23">
<span id="training-2022-spring-best-practices-notes-day1"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">Questions and answers from Best Practices on NRIS Clusters May 2022, Day 1 (May 23)</a><a class="headerlink" href="#questions-and-answers-from-best-practices-on-nris-clusters-may-2022-day-1-may-23" title="Link to this heading"></a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#questions-and-answers-from-best-practices-on-nris-clusters-may-2022-day-1-may-23" id="id1">Questions and answers from Best Practices on NRIS Clusters May 2022, Day 1 (May 23)</a></p>
<ul>
<li><p><a class="reference internal" href="#icebreaker-question" id="id2">Icebreaker question</a></p></li>
<li><p><a class="reference internal" href="#best-practices-and-trouble-shooting" id="id3">Best Practices and trouble shooting</a></p></li>
<li><p><a class="reference internal" href="#exercise-scaling" id="id4">Exercise scaling</a></p></li>
<li><p><a class="reference internal" href="#choosing-memory-and-core-settings" id="id5">Choosing memory and core settings</a></p></li>
<li><p><a class="reference internal" href="#exercise-15-min" id="id6">Exercise (15 min)</a></p>
<ul>
<li><p><a class="reference internal" href="#results-from-exercises" id="id7">Results from exercises</a></p></li>
<li><p><a class="reference internal" href="#feedback-day-1" id="id8">Feedback Day 1</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="icebreaker-question">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Icebreaker question</a><a class="headerlink" href="#icebreaker-question" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>What would you like to get out of this workshop?</p>
<ul>
<li><p>(Add answers below with a leading -)</p></li>
<li><p>How to install custom python repositories / environments on the cluster. +1</p></li>
<li><p>How to write code that takes advantage of this cluster (parrellel programming, GPU)</p></li>
<li><p>How to calculate CPU and memory for my job</p></li>
<li><p>How to best manage my data (200gb video files) +1</p></li>
<li><p>How to best manage my data reading (20 TB, 2 million files with 2-100 MB, and I’m reading ~300 files ~= 2 GB at a time)? What are the best practices for reading such data, what are the don’ts?</p></li>
<li><p>How to make my code faster ;)</p></li>
<li><p>How to compile open source software on a cluster</p></li>
<li><p>How to do data analysis and view the plots in FRAM?</p></li>
</ul>
</li>
</ul>
</section>
<section id="best-practices-and-trouble-shooting">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Best Practices and trouble shooting</a><a class="headerlink" href="#best-practices-and-trouble-shooting" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Now that we learned that we should probably not use hyperthreading, how do I turn hyperthreading on or off?</p>
<ul class="simple">
<li><p>Hyperthreading is turned off b in Slurmy default. On the norwegian HPC systems if you ask for cores (e.g. ntasks), you get allocated physical cores.</p></li>
<li><p>If you know what you are doing then you may enable this with “–ntasks-per-core=2” SBATCH parameter</p></li>
<li><p><a class="reference external" href="https://documentation.sigma2.no/jobs/job_scripts/slurm_parameter.html">More Details</a></p></li>
</ul>
</li>
<li><p>Can you define what exactly you mean with random read?</p>
<ul class="simple">
<li><p>the opposite of a random read would be to read “at the end” or read in the same order as the data was written</p></li>
<li><p>random read would be to read “somewhere”, not necessarily in order</p></li>
<li><p>in other words during a random read, the reading device needs to move from one place to another and cannot keep reading and thus spends a lot of time “moving” and not reading</p></li>
</ul>
</li>
<li><p>“Try to not copy files”: but somewhere we also hear/read to not run from HOME. So should we rather keep them on HOME and run from there?</p>
<ul class="simple">
<li><p>The comment about copying is referring to parallel file systems. Which means your HOME or project area are the same in that sense (on the /cluster partition).</p></li>
<li><p>If you have millions of read/write, then using the localscratch (see the question 4 below) would make it more efficient.</p></li>
<li><p>This you have to plan, i.e. there is no universal answer, e.g you have pne big file and you are planing to access it millions of time during then better to copy it to local scratch (Q4 below). Copying that files inside the /cluster to somewhare else would not make a difference.</p></li>
</ul>
</li>
<li><p>What is a local scratch?</p>
<ul class="simple">
<li><p>Local scratch is a local storage on the compute node, hard drive, Solid State disk, NVMe etc.</p></li>
<li><p>More abot this: <a class="reference external" href="https://documentation.sigma2.no/jobs/scratchfiles.html">https://documentation.sigma2.no/jobs/scratchfiles.html</a></p></li>
<li><p>all other storage is accessed via network but “local scratch” is a hard drive that is inside the same “box” as the CPU and memory and has thus much faster access</p></li>
</ul>
</li>
<li><p>What does MPI mean?</p>
<ul class="simple">
<li><p>message passing interface. it is one of several techniques/protocols to run a code in parallel. it is suitable for problems where the independent “tasks” need to communicate and where they are not completely independent.</p></li>
<li><p>if the jobs/tasks are completely independent, then MPI is typically not a suitable tool to parallelize but job arrays might be more suitable</p></li>
<li><p>Not offitial explanation, but how I try to think of it: On a compute cluster compute nodes are connected using fast network, so data can be moved fast between them. However memory/RAM of each compute node are isolated. i.e. if you assign a value to a variable in memory on one compute node (e.g. A=10), other compute nodes would not know it. So MPI can help you make this connection, i.e. let your program know and use what is going on on a nother computer on the cluster. Then MPI helps to consolidate the results at the end as well.</p></li>
<li><p>All the executables launched by mpirun are identical, they get asigned a rank and total rank number. The only way they can communicate is by sending a message fram one rank to another.</p></li>
<li><p>As programmers generally need to know to program in parallel the MPI programs tend to scale better than OpenMP/Shared memory.</p></li>
</ul>
</li>
</ol>
</section>
<section id="exercise-scaling">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Exercise scaling</a><a class="headerlink" href="#exercise-scaling" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Copy the directory <code class="docutils literal notranslate"><span class="pre">/cluster/projects/nn9989k/nris-best-practices/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-r</span> <span class="pre">/cluster/projects/nn9989k/nris-best-practices/</span> <span class="pre">.</span></code></p></li>
<li><p>inside there, consider only the <code class="docutils literal notranslate"><span class="pre">Day1/scaling</span></code> part</p></li>
<li><p>The current exercise is in the directory NPB <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">Day1/scaling/NPB</span></code></p></li>
<li><p>there is also a README.txt with instructions</p></li>
<li><p>the other two exercises below <code class="docutils literal notranslate"><span class="pre">Day1</span></code> are for later today</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>Where do we run the exercise today ?</p>
<ul class="simple">
<li><p>meaning on which cluster? on Saga</p></li>
<li><p>but if there is any problem there, the same exercise folder can also be found on Fram</p>
<ul>
<li><p>I logged into the folder in saga</p></li>
<li><p>once on Saga you can copy the exercise folder to your home: <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">-r</span> <span class="pre">/cluster/projects/nn9989k/nris-best-practices/</span> <span class="pre">.</span></code></p></li>
<li><p>Yes its done</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Whats going on? I dont hear anything</p>
<ul class="simple">
<li><p>currently exercise session until 10:15 (see above for instructions)</p></li>
<li><p>you can join one of the breakout rooms (bottom right in Zoom window)</p></li>
<li><p>we will resume after the exercise</p></li>
</ul>
</li>
<li><p>Should we be using Fram or Saga? I did the scaling exercise on Fram but maybe it’s better to use Saga instead?</p>
<ul class="simple">
<li><p>our primary cluster for this course is Saga but Fram is “backup” if there is some problem on Saga but same account and reservation is put in place on both</p></li>
<li><p>but it’s no problem that you ran these on Fram</p></li>
</ul>
</li>
<li><p>What “Mop/s/process” stands for? I got the following:</p>
<ul class="simple">
<li><p>slurm-4nodes.out: Mop/s/process   =                 2035.09</p></li>
<li><p>slurm-9nodes.out: Mop/s/process   =                  1836.85</p></li>
<li><p>slurm-16nodes.out: Mop/s/process  =                   1178.52
what’s the conclusion from the result?? More nodes then less operations?</p></li>
<li><p>The purpose of the exercise was to measure the performance for different number of tasks of the simulation. Its measure is Mop/s/process, where Mop/s = million of operations per second.</p></li>
<li><p>The results above show that the performance decreases with increasing number of tasks, which is bad, meaning that to use resources optimally you should use fewer tasks. This is a very small simulation, and it does not really matter if it takes 20 or 50 seconds. For realistic simulations (think hours or days), you should do some tests to find out a good balance between performance (Mop/s/process) and the time needed to run the simulation.</p></li>
</ul>
</li>
<li><p>How do I make plots in linux? (related to the scaling task)</p>
<ul class="simple">
<li><p>many people use Python/matplotlib or R/ggplot2</p></li>
<li><p>there is also gnuplot</p></li>
</ul>
</li>
<li><p>Can you share the plotting technic used</p>
<ul class="simple">
<li><p>I will ask the instructor after the session to share the script, I think it is a gnuplot script</p></li>
<li><p>The simple solution is using a spreadsheet</p></li>
</ul>
</li>
<li><p>Command to explain later</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ldd</span> <span class="pre">&lt;binary&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">strings</span> <span class="pre">&lt;binary&gt;</span></code> (read man pages : man ldd and man strings)</p></li>
</ul>
</li>
</ol>
</section>
<section id="choosing-memory-and-core-settings">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Choosing memory and core settings</a><a class="headerlink" href="#choosing-memory-and-core-settings" title="Link to this heading"></a></h2>
<p>We will follow:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://documentation.sigma2.no/jobs/choosing-memory-settings.html">https://documentation.sigma2.no/jobs/choosing-memory-settings.html</a></p></li>
<li><p><a class="reference external" href="https://documentation.sigma2.no/jobs/choosing-number-of-cores.html">https://documentation.sigma2.no/jobs/choosing-number-of-cores.html</a></p></li>
</ul>
<ol class="arabic simple" start="13">
<li><p>What is the command to check the quota required for a submitted job?</p></li>
</ol>
<ul class="simple">
<li><p>compute quota: <code class="docutils literal notranslate"><span class="pre">cost</span></code></p></li>
<li><p>storage quota: <code class="docutils literal notranslate"><span class="pre">dusage</span></code></p></li>
<li><p>There is no quota “for the submited job”. The quota is on how many CPU hours you have remaining in the project and how much storage space you have left.</p></li>
</ul>
<ol class="arabic simple" start="14">
<li><p>How can I specify that I want 16 tasks on specified nodes?</p>
<ul class="simple">
<li><p>You shall also specify the nodes : e.g. <code class="docutils literal notranslate"><span class="pre">--nodelist=c1-2,c1-3</span></code> (assuming you have the right to run on these nodes)</p></li>
<li><p>wasn’t that done in the example? would that be ntask-per-node? Yes, nodes=1 and ntask-per-node=16 since Slurm multiply nodes with ntasks-per-node it will allocate 16 cores on the node.</p></li>
</ul>
</li>
<li><p>I have tried to follow the info on localscratch, but I am unable to get a value in ${LOCALSCRATCH}. On Saga. Like</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --gres=localscratch:2G</span>
<span class="n">echo</span> <span class="s2">&quot;localscratch: $</span><span class="si">{LOCALSCRATCH}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>gives me <code class="docutils literal notranslate"><span class="pre">sbatch:</span> <span class="pre">error:</span> <span class="pre">contain</span> <span class="pre">a</span> <span class="pre">NULL</span> <span class="pre">character</span> <span class="pre">'\0'.</span></code></p>
<ul class="simple">
<li><p>Have you got an example script that runs this?</p></li>
<li><p>Try : /cluster/projects/nn9989k/nris-best-practices/Day1/slurm/localscratch.run</p></li>
<li><p>Thank you.</p></li>
</ul>
<ol class="arabic simple" start="16">
<li><p>The command “seff” doesn’t give any information on GPU usage I see, or is there something similar for GPU usage (other than the log files themselves)?</p>
<ul class="simple">
<li><p>I think seff don’t compute GPU effficiency according to the <code class="docutils literal notranslate"><span class="pre">seff</span></code> code <a class="reference external" href="https://github.com/SchedMD/slurm/blob/master/contribs/seff/seff">seff</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sacct'</span> <span class="pre">combined</span> <span class="pre">with</span>&#160; <span class="pre">'Reqgres</span></code>command can use to list the requested GPU nodes, may be not indices.</p></li>
<li><p><a class="reference external" href="https://slurm.schedmd.com/sacct.html">sacct</a></p></li>
<li><p>You can monitor GPU utilization, Please see our documentation <a class="reference external" href="https://documentation.sigma2.no/getting_started/tutorials/gpu/cuda.html#step-3-monitor-the-gpu-utilization">here</a></p></li>
</ul>
</li>
<li><p>Could you explain CPU Utilized and CPU Efficiency and Job Wall-clock time on the seff output? How does one use this info to better structure job scripts?</p>
<ul class="simple">
<li><p>If you use too many cores and waste time in admin the util goes down. Hence monitor util and check that it’s not too low.</p></li>
<li><p>Job Wall-clock time is the time used by the job. CPU Utilized is the time used by all CPUs, i.e. each CPU ran x Job Wall-clock time.</p></li>
</ul>
</li>
<li><p>Is it possible to say anything general about in what type of computation it can be expected that concentrating the cores to a single node is beneficial or not?</p>
<ul class="simple">
<li><p>Concentrating the cores in a singe node is always preferable if possible. Slurm will do this by default if resources are available.</p></li>
<li><p>RB: I don’t fully agree. I normally prefer to not concentrate them until I know that it has any effect. Letting the scheduler distribute them gives it more flexibility and less queue time for me. It can matter but in my experience more often than not it does not matter for smaller calculations.</p></li>
</ul>
</li>
<li><p>Which module and version did you load for the <code class="docutils literal notranslate"><span class="pre">perf-report</span></code> tool?</p>
<ul class="simple">
<li><p><a class="reference external" href="https://documentation.sigma2.no/jobs/choosing-number-of-cores.html#example-for-a-memory-bound-job">https://documentation.sigma2.no/jobs/choosing-number-of-cores.html#example-for-a-memory-bound-job</a></p></li>
<li><p>it was <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">Arm-Forge/21.1</span></code></p></li>
<li><p>then prepend the command with <code class="docutils literal notranslate"><span class="pre">perf-report</span></code></p></li>
</ul>
</li>
</ol>
</section>
<section id="exercise-15-min">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Exercise (15 min)</a><a class="headerlink" href="#exercise-15-min" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Copy files from here: <code class="docutils literal notranslate"><span class="pre">/cluster/projects/nn9989k/nris-best-practices/</span></code></p></li>
<li><p>Consider only the <code class="docutils literal notranslate"><span class="pre">how-much-memory</span></code> and <code class="docutils literal notranslate"><span class="pre">how-many-cores</span></code></p></li>
<li><p>how-much-memory:</p>
<ul>
<li><p>first run the script as is: <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">run.sh</span></code></p></li>
<li><p>then try to find out how much memory binary-a is using</p></li>
<li><p>use <a class="reference external" href="https://documentation.sigma2.no/jobs/choosing-memory-settings.html">https://documentation.sigma2.no/jobs/choosing-memory-settings.html</a></p></li>
</ul>
</li>
<li><p>how-many-cores:</p>
<ul>
<li><p>first run the script as is: <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">run.sh</span></code></p></li>
<li><p>then try to find out optimal number of cores/tasks for binary-b</p></li>
<li><p><a class="reference external" href="https://documentation.sigma2.no/jobs/choosing-number-of-cores.html">https://documentation.sigma2.no/jobs/choosing-number-of-cores.html</a></p></li>
</ul>
</li>
<li><p>You can also try to analyze your own code or run script</p></li>
</ul>
<hr class="docutils" />
<ol class="arabic simple" start="20">
<li><p>If you run a combined MPI &amp; OpenMP job on Saga, how do you deal with he fact that there is a different number of cores on the different nodes?</p>
<ul class="simple">
<li><p>hmmm. very good question. in this case you could ask for tasks per node for the node type with the higher core count? or how do others do that?</p>
<ul>
<li><p>What happens then to MPI ranks that have less cores? Stupid question: Can they easily discover the number or cores avvilable to them?</p></li>
<li><p>Slurm allocate cores on different nodes in such a way that you get what you asked for. You may only get part of the nodes with more cores than on nodes with less cores. You should not have to worry too much about this. Slurm generally do a good job.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Could you please summarize all of the tools for finding optimized parameters? like seff…</p>
<ul class="simple">
<li><p>good question. I will summarize in voice</p>
<ul>
<li><p>memory: probably easiest is run job and then seff</p></li>
<li><p>cores: run a series of jobs and compare timings but make sure the job is not too quick as the comparison is then not conclusive. later drill more into the calculation with seff and perf-report</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Are different nodes with different amount of memory/core accounted differently at NRIS?</p>
<ul class="simple">
<li><p>here is detailed information: <a class="reference external" href="https://documentation.sigma2.no/jobs/projects_accounting.html">https://documentation.sigma2.no/jobs/projects_accounting.html</a></p></li>
<li><p>in short: ask for what the job needs and you probably don’t need to worry too much (except sharing the project allocation with other project members responsibly). the accounting can become a problem if you request much more resources than are actually used. also memory, not only cores.</p></li>
</ul>
</li>
<li><p>Regarding reading data: You mentioned a few simple do’s and dont’s, but is there any more advice / tools for taking care of tricky file reading / databases?</p>
<ul class="simple">
<li><p>E.g.: I have a database of 20 TB on Saga, 2 million files with 2-100 MB where I’m reading ~300 files ~= 2 GB at a time (16 parallel read processes seems to help here to speed up efficiently). But should I check that the 300 consecutive files are well distributed across disks rather than just the same single disk / RAID so that I’m not limiting reading because only one disk / RAID is accessed at the same time?</p>
<ul>
<li><p>I expect ypu are on Saga. yes</p></li>
</ul>
</li>
<li><p>considering I’m running an array job on e.g., 4-8 nodes, using all CPUs on each node - anything else to consider?  - The DB is just files in a specific structure. Each file is is read into memory as a whole (so no random read I think) so I don’t think Localscratch helps. The question is more on how to avoid bottlenecks in case the data is all on the same physical disk / raids, or what to consider there.</p>
<ul>
<li><p>If you do a lot of work on each file, like random read you could move the files to localscratch.</p></li>
<li><p>Why do you need to copy the files, are you extracting files from the db ?</p></li>
<li><p>Point is that you might overload the db, does it scale ? There is a limit on how many requests is optimal for the db.</p></li>
<li><p>The more you read from the db the more of it will be cached in the FS and new reads might be in the cache. With such big db the files would be spread over a number of RAID sets, hence you should get good parallel performance. Try to run scaling test when reading from the db. Mayby you are optimal, of maybe even more threads could perform better. - Ok thanks!</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Is there a maximum number of cpus you can ask for in a job (on Saga)?</p>
<ul class="simple">
<li><p>For Saga job limits please see the <a class="reference external" href="https://documentation.sigma2.no/jobs/choosing_job_types.html#saga">documentation</a></p></li>
</ul>
</li>
<li><p>Is using the cluster mostly a good solution if I need more cores/gpu’s? If my job needs just a few powerful cores and 200gb RAM is it better to just use a personal workstation and buy the RAM?</p>
<ul class="simple">
<li><p>cluster may be good if you need many cores. the key is really the “many”, not the “fast”. often the CPUs on a cluster a slower than on a laptop but there are many more.</p></li>
<li><ul>
<li><p>Is the cluster good for jobs that need a high amount of memory but a low number of cores? What is the maximum amount of RAM per core?</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Where can I find the next Q&amp;A session (the monthly event)?</p></li>
</ol>
<ul class="simple">
<li><p><a class="reference external" href="https://documentation.sigma2.no/getting_help/qa-sessions.html">NRIS Monthly Q&amp;A</a></p></li>
</ul>
<ol class="arabic simple" start="27">
<li><p>Is there a tool like top/htop that can tell me about how busy the file system is? I have experienced that my Python scripts take &gt; 60 s to import packages (usually less than 2 s), so I can only guess that the file system was slow / busy?</p>
<ul class="simple">
<li><p>we are aware that sometimes it can be very difficult for users to see whether it is slow because of something they do or slow because of the file system (slowed down due to to other reasons). we are working on setting up better dashboards with health checks so that it becomes easier to see.</p></li>
<li><p>currently the best option is to check <a class="reference external" href="https://opslog.sigma2.no/">https://opslog.sigma2.no/</a></p></li>
</ul>
</li>
<li><p>Are the results of the exercise correct?</p>
<ul class="simple">
<li><p>yes. great job!</p></li>
</ul>
</li>
</ol>
<section id="results-from-exercises">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Results from exercises</a><a class="headerlink" href="#results-from-exercises" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>what did you find out? what was the memory requirement for <code class="docutils literal notranslate"><span class="pre">binary-a</span></code>?
Memory Utilized: 2.24 GB
Memory Efficiency: 65.44% of 3.42 GB</p></li>
<li><p>and what <code class="docutils literal notranslate"><span class="pre">--num-tasks</span></code> would you recommend for <code class="docutils literal notranslate"><span class="pre">binary-b</span></code>?
Nodes: 1
Cores per node: 4</p></li>
</ul>
</section>
<section id="feedback-day-1">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Feedback Day 1</a><a class="headerlink" href="#feedback-day-1" title="Link to this heading"></a></h3>
<p>One thing you thought was good:</p>
<ul class="simple">
<li><p>The second session was very practical and interactive –&gt; that was very helpful +1</p></li>
<li><p>Enjoyed the content of both sessions. The instructors were good at pointing out what to think of when tailoring the slurm scripts for a particular simulation. <code class="docutils literal notranslate"><span class="pre">strings</span></code> was a discovery for me too :). Nice you have several tools documented to check CPU and memory usage. I like the <code class="docutils literal notranslate"><span class="pre">time</span></code> wrapper a lot. Used <code class="docutils literal notranslate"><span class="pre">perf-report</span></code> before, a favourite too.</p></li>
<li><p>Not so much to do with today, but the docs on <a class="reference external" href="https://documentation.sigma2.no/">https://documentation.sigma2.no/</a> are really getting very good!</p></li>
<li><p>The demo using the terminal was nicely made. Appropriate tempo. The user/directory coloring and extra command window at the bottom were helpful.</p></li>
</ul>
<p>One thing that should be improved until tomorrow or next time:</p>
<ul class="simple">
<li><p>The first part was very abstract, and then very specific. A more middle approach with more simple practical information with more context would be much more useful +1</p></li>
<li><p>Some of the terminology was already to advanced for me (e.g. MPI, localscratch…) +1</p></li>
<li><p>The first exercise would need more explanation for first-time users. There is a typo in <code class="docutils literal notranslate"><span class="pre">scontrol</span> <span class="pre">show</span> <span class="pre">job</span> <span class="pre">$jobid</span></code> (it was with capital S). A bit less scrolling maybe when presenting the content on the website.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Integrate opslog banner -->
<span class="sp-status"></span>
<script>
  window.statuspalWidget = {
    subdomain: 'sigma2-nris',
    host: 'https://statuspal.eu',
    badge: {
      enabled: false,
      selector: '.sp-status', 
    },
    banner: {
      enabled: true,
      position: 'top-right',
    }
  }
</script>
<script src="https://statuspal.io/js/widget.js"></script>


</body>
</html>